package com.example.demo.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import com.example.demo.entity.Gakusei;
import com.example.demo.service.GakuseiService;

@Controller
@RequestMapping("/gakusei")
public class GakuseiController {

	@Autowired
	private GakuseiService gakuseiService;

	// å­¦ç”Ÿä¸€è§ˆè¡¨ç”»é¢
	@GetMapping("")
	public String showGakuseiList(Model model) {
		List<Gakusei> gakuseiList = gakuseiService.getGakuseiKurasuTensuList(new Gakusei());
		// æ‰“å°æµ‹è¯•ç»“æœï¼Œè®°å¾—åˆ æ‰
		for (Gakusei g : gakuseiList) {
			System.out.println("â†’ " + g.getGakuseiId() + " | " + g.getNamae() + " | " + g.getKurasuNamae());
		}
		model.addAttribute("gakuseiList", gakuseiList);
		return "gakusei/gakusei";
	}

	// å­¦ç”Ÿæƒ…æŠ¥è¯¦ç»†ç”»é¢
	@GetMapping("/gakuseishousai")
	public String showGakuseiDetail(@RequestParam("gakuseiId") Integer gakuseiId, Model model) {
		Gakusei param = new Gakusei();
		param.setGakuseiId(gakuseiId);
		Gakusei gakuseiDetail = gakuseiService.getGakuseiDetail(param);
		model.addAttribute("gakuseiDetail", gakuseiDetail);
		return "gakusei/gakuseishousai";
	}

	// å­¦ç”Ÿæƒ…æŠ¥æ›´æ–°ç”»é¢
	@GetMapping("/update")
	public String showUpdatePage(@RequestParam("gakuseiId") Integer gakuseiId, Model model) {
		Gakusei param = new Gakusei();
		param.setGakuseiId(gakuseiId);
		Gakusei gakusei = gakuseiService.getGakuseiById(param);
		model.addAttribute("singleGakusei", gakusei);
		return "gakusei/gakuseiupdate";
	}

	// æ›´æ–°ç”»é¢ -> æ•°æ®æ›´æ–°
	@PostMapping("/updateGakuseiInfo")
	@ResponseBody
	public String updateGakuseiInfo(Gakusei gakusei) {
		// æ‰“å°æµ‹è¯•ç»“æœï¼Œè®°å¾—åˆ æ‰
		System.out.println("æ›´æ–°å­¦ç”Ÿä¿¡æ¯ï¼š" + gakusei.getNamae());
		gakuseiService.updateGakuseiInfo(gakusei);
		return "success";
	}

	// å­¦ç”Ÿæƒ…æŠ¥æ–°è¦ç”»é¢
	@GetMapping("/insert")
	public String showInsertPage(Model model) {
		model.addAttribute("gakusei", new Gakusei());
		return "gakusei/gakuseiinsert";
	}

	// å­¦ç”Ÿæ–°è¦ç™»éŒ²
	@PostMapping("/insertGakuseiInfo")
	@ResponseBody
	public String insertGakusei(Gakusei gakusei) {
		gakuseiService.insertGakusei(gakusei);
		return "success";
	}

	// å­¦ç”Ÿæ–°è§„ç”»é¢-æ”¾å¤§é•œåŠŸèƒ½(ç­çº§åæ¨¡ç³Šæ¤œç´¢)
	@GetMapping("/searchByKurasuNamae")
	@ResponseBody
	public List<Gakusei> searchByKurasuNamae(@RequestParam("kurasuNamae") String kurasuNamae) {
		// æ‰“å°æµ‹è¯•ç»“æœï¼Œè®°å¾—åˆ æ‰
		System.out.println("ğŸ” ã‚¯ãƒ©ã‚¹æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼š" + kurasuNamae);
		return gakuseiService.searchByKurasuNamae(kurasuNamae);
	}

	/** å­¦ç”Ÿå‰Šé™¤(è®ºç†åˆ é™¤) */
	@PostMapping("/deleteGakuseiInfo")
	@ResponseBody
	public String deleteGakuseiInfo(@RequestParam("gakuseiId") int gakuseiId) {
		System.out.println("å‰Šé™¤å¯¾è±¡å­¦ç”ŸIDï¼š" + gakuseiId);
		gakuseiService.deleteGakuseiInfo(gakuseiId);
		return "success";
	}

}

