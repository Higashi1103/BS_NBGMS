$(function() {
	/* モックボックス */
	$("#openSearchModal").click(function() {
		$("#searchModal").modal("show");
		$("#searchNamae").val("");
		// 空文字で全員表示
		searchByNamae("");
		$("#confirmSelection").prop("disabled", true);
	});

	/* あいまい検索 */
	$("#searchNamae").on("input", function() {
		var namae = $(this).val();
		searchByNamae(namae);
	});

	/* Ajax検索関数 */
	function searchByNamae(namae) {
		$.ajax({
			url: "/tensushousaihenko/searchByNamae",
			method: "GET",
			data: { namae: namae },
			success: function(data) {
				$("#searchResult").empty();

				if (data.length === 0) {
					$("#searchResult").append("<li class='list-group-item error'>該当なし</li>");
				} else {
					data.forEach(function(item) {
						$("#searchResult").append(
							`<li class='list-group-item search-item' 
                                data-namae='${item.namae}' 
                                data-id='${item.gakuseiId}'
                                data-rireki='${item.rirekiId || ""}'>
                                ${item.namae}（ID: ${item.gakuseiId}）</li>`
						);
					});

					// 学生選択時の処理
					$(".search-item").off("click").on("click", function() {
						var selectedNamae = $(this).data("namae");
						$("#searchNamae").val(selectedNamae);  
						$(".search-item").removeClass("selected");
						$(this).addClass("selected");
						$("#confirmSelection").prop("disabled", false);
					});
				}
			},
			error: function() {
				$("#searchResult").html("<li class='list-group-item text-danger error'>検索エラー</li>");
				$("#confirmSelection").prop("disabled", true);
			}
		});
	}
	});