<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.mapper.ShuturyokuMapper">
	<resultMap id="ExportDataMap"
		type="com.example.demo.dto.ShuturyokuDTO">
		<!-- WARNING - @mbg.generated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon Oct 27 
			15:55:24 JST 2025. -->

		<result property="kurasuId" column="KURASU_ID" />
		<result property="kurasuNamae" column="KURASU_NAMAE" />
		<result property="kurasuKamoku" column="KURASU_KAMOKU" />
		<result property="tantoSensei" column="TANTO_SENSEI" />
		<result property="memo" column="MEMO" />

		<result property="gakuseiId" column="gakusei_id" />
		<result property="namae" column="namae" />
		<result property="seibetsu" column="seibetsu" />
		<result property="seinengappi" column="seinengappi" />
		<result property="saishuGakureki" column="saishu_gakureki" />
		<result property="gogakuryoku" column="gogakuryoku" />
		<result property="tensu" column="tensu" />
		<result property="hyouka" column="hyouka" />
		<result property="sonota" column="sonota" />

		<result property="rirekiId" column="rireki_id" />
		<result property="kagenTensu" column="kagen_tensu" />
		<result property="gutaiRiyu" column="gutai_riyu" />
		<result property="hasseiBi" column="hassei_bi" />
		<result property="tensuBiko" column="tensu_biko" />

		<result property="hiaringuId" column="hiaringu_id" />
		<result property="hiaringuTantousya" column="tantousya" />
		<result property="hiaringuNichiji" column="hiaringu_nichiji" />
		<result property="hiaringuJikan" column="hiaringu_jikan" />
		<result property="hiaringuBasyo" column="hiaringu_basyo" />
		<result property="hiaringuGenin" column="hiaringu_genin" />
		<result property="hiaringuNaiyou" column="hiaringu_naiyou" />
		<result property="hiaringuBiko" column="hiaringu_biko" />

	</resultMap>

	<select id="selectExportData" resultMap="ExportDataMap"
		parameterType="map">
		SELECT
		k.KURASU_ID,
		k.KURASU_NAMAE,
		k.KURASU_KAMOKU,
		k.TANTO_SENSEI,
		k.MEMO,
		g.gakusei_id,
		g.namae,
		g.seibetsu,
		g.seinengappi,
		g.saishu_gakureki,
		g.gogakuryoku,
		g.tensu,
		g.hyouka,
		g.sonota,
		t.rireki_id,
		t.kagen_tensu,
		r.gutai_riyu,
		t.hassei_bi,
		t.bikou as
		tensu_biko,
		h.hiaringu_id,
		h.tantousya,
		h.hiaringu_nichiji,
		h.hiaringu_jikan,
		h.hiaringu_basyo,
		h.hiaringu_genin,
		h.hiaringu_naiyou,
		h.bikou as hiaringu_biko
		FROM gakusei g
		LEFT JOIN kurasu_info k ON
		g.kurasu_id = k.KURASU_ID
		LEFT JOIN tensu_henkou_rireki t ON
		t.gakusei_id = g.gakusei_id
		LEFT JOIN kagen_riyu r ON r.riyu_id =
		t.riyu_id
		LEFT JOIN jinji_hiaringu h ON g.gakusei_id = h.gakusei_id
		<where>
			<if test="kurasuNamae != null">
				AND k.KURASU_NAMAE = #{kurasuNamae}
			</if>

			<!-- 选择所有班级 + 年份 -->
			<if test="kurasuNamae == null and year != null">
				AND k.KURASU_NAMAE LIKE CONCAT('%', #{year}, '%')
			</if>
		</where>
		ORDER BY k.KURASU_ID DESC, g.gakusei_id
	</select>

	<select id="selectDistinctKurasu" resultType="string">
		SELECT KURASU_NAMAE
		FROM kurasu_info
		ORDER BY KURASU_ID DESC
	</select>

</mapper>