<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<title>ユーザー一覧｜技術者管理システム</title>
	<meta charset="utf-8">
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js"></script>
	<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap.min.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap.min.css" rel="stylesheet">

	<style>
		.navbar {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 51px;
			background-color: #f9f9f9;
			color: #000000;
			display: flex;
			align-items: center;
			padding: 0 10px;
			box-sizing: border-box;
			z-index: 1000;
			border-bottom: 1px solid #e5e5e5;
		}

		a {
			letter-spacing: 0.05em;
		}

		#title {
			position: absolute;
			left: 10px;
			top: 50%;
			transform: translateY(-50%);
			font-size: 18px;
			color: #777;
		}

		#user {
			position: absolute;
			right: 20px;
			top: 50%;
			transform: translateY(-50%);
			cursor: pointer;
		}

		.dropdown-menu {
			display: none;
			position: absolute;
			top: 40px;
			right: 0;
			transform: translateX(-90px);
			background-color: #fff;
			border: 1px solid #ddd;
			border-radius: 5px;
			box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
			min-width: 110px;
			z-index: 2000;
		}

		.dropdown-menu a {
			display: block;
			padding: 8px 10px;
			color: #333;
			text-decoration: none;
			font-size: 14px;
		}

		.dropdown-menu a:hover {
			background-color: #f2f2f2;
		}


		.sidebar {
			position: fixed;
			top: 51px;
			left: 0;
			width: 250px;
			height: calc(100% - 51px);
			background-color: #f9f9f9;
			color: rgb(48, 48, 48);
			box-sizing: border-box;
			border-right: 1px solid #e5e5e5;
		}

		.sidebar-nav div {
			margin: 0;
			padding: 10px;
			border-bottom: 1px solid #e5e5e5;

		}

		.sidebar-nav div a {
			color: #337ab7;
			font-size: 14px;
			text-decoration: none;
			display: flex;
			align-items: center;
		}

		.sidebar-nav div:hover {
			background-color: #e6e6e6;
			color: #fff;
		}

		.main-content {
			margin-top: 30px;
			margin-left: 240px;
			padding: 40px;
			min-height: calc(100vh - 51px);
			background-color: #fff;
			display: flex;
			justify-content: center;
		}

		#ichiran {
			width: 1060px;
			table-layout: fixed;
			width: 100%;
			word-wrap: break-word;
		}

		#shinkibtn {
			margin-bottom: 10px;
			text-align: right;
			background-color: rgb(155, 210, 135);

		}

		table td,
		table th {
			vertical-align: middle !important;
		}

		.overlay {
			position: fixed;
			top: 0;
			left: 0;
			width: 100vw;
			height: 100vh;
			background: rgba(0, 0, 0, 0.45);
			display: flex;
			align-items: center;
			justify-content: center;
			z-index: 9999;
		}

		.dialog {
			background: white;
			border-radius: 12px;
			width: 400px;
			height: 200px;
			box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
			display: flex;
			flex-direction: column;
			justify-content: space-between;
		}

		.dlgTitle {
			background-color: #d9534f;
			margin: 0;
			border-radius: 12px 12px 0 0;
			padding: 10px;
			text-align: center;
			color: white;
			font-weight: bold;
		}

		.center {
			text-align: center;
		}

		#dialogBtns {
			display: flex;
			justify-content: center;
			gap: 20px;
			margin-bottom: 20px;
		}
	</style>
</head>

<body>
	<!-- ヘッド -->
	<nav class="navbar" style="margin-bottom: 0">
		<div id="title">技術者管理システム</div>

		<!-- ログアウトバタン -->
		<div id="user">
			<img src="/image/user.png" height="25px">
			<div class="dropdown-menu" id="dropdownMenu">
				<a href="/maipeji">マイページ</a>
				<a href="/yuzaichiran">ユーザー一覧</a>
				<a href="/logout" id="logoutLink">ログアウト</a>
			</div>
		</div>

		<!-- 左ナビ -->
		<div class="sidebar">
			<div class="sidebar-nav">
				<div>
					<a th:href="@{/kurasu}"><img src="/image/kurasu.png" height="18px"
							style="margin-right: 5px;">クラス情報</a>
				</div>
				<div>
					<a th:href="@{/gakusei}"><img src="/image/gakusei.png" height="18px"
							style="margin-right: 5px;">学生情報</a>
				</div>
				<div>
					<a th:href="@{/tensu}"><img src="/image/pointo.png" height="18px"
							style="margin-right: 5px;">ポイント履歴</a>
				</div>
				<div>
					<a th:href="@{/hiaringu}"><img src="/image/hiaringu.png" height="18px"
							style="margin-right: 5px;">ヒアリング履歴</a>
				</div>
				<div>
					<a th:href="@{/shuturyoku}"><img src="/image/shutsuryoku.png" height="18px"
							style="margin-right: 5px;">出力</a>
				</div>
			</div>
		</div>
	</nav>

	<div class="main-content">
		<div id="table-content">
			<div class="col-lg-12">
				<div id="overlay" class="overlay" style="display:none;" role="dialog" aria-modal="true">
					<div class="dialog" tabindex="-1">
						<h4 class="dlgTitle">削除選択</h4>
						<div class="center">
							<h5 id="confirmText">選択したユーザーを削除しますが、よろしいですか？</h5>
							<br>
						</div>
						<div id="dialogBtns">
							<button id="btnOk" class="btn btn-success">確定</button>
							<button id="btnNo" class="btn btn-warning">取消</button>
						</div>
					</div>
				</div>
				<div class="panel panel-default">
					<div class="panel-heading">
						ユーザー一覧
					</div>
					<div class="panel-body">
						<table class="table table-striped table-bordered table-hover" id="ichiran">
							<thead>
								<tr>
									<th>ID</th>
									<th>パスワード</th>
									<th>名前</th>
									<th>作成時間</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody>
								<tr class="odd gradeX" th:each="yuza : ${yuzas}">
									<td th:text="${yuza.yuzaId}"></td>
									<td th:text="${yuza.yuzaPwd}"></td>
									<td th:text="${yuza.yuzaNamae}"></td>
									<td th:text="${yuza.sakuseijikan}"></td>
									<td>
										<form th:if="${yuza.yuzaId != currentUserId}" th:action="@{/yuza/delete}"
											method="post" class="deleteForm">
											<input type="hidden" name="yuzaId" th:value="${yuza.yuzaId}" />
											<button type="button" class="btn btn-danger btn-sm deleteBtn">削除</button>
										</form>
									</td>
								</tr>
							</tbody>
						</table>
						<div class="text-right" style="margin-top: 9px;">
							<form th:action="@{/yuzaNew}" method="get">
								<button type="submit" class="btn btn-success">新規</button>
							</form>
						</div>
					</div>
				</div></div>
				</div>
				</div>
				<div id="logoutOverlay" style="
				    position: fixed;
				    top: 0; left: 0;
				    width: 100%; height: 100%;
				    background: rgba(0, 0, 0, 0.5);
				    display: none;
				    justify-content: center;
				    align-items: center;
				    z-index: 9999;">
					<div class="dialog">
						<p class="dlgTitle">ログアウト確認</p>
						<div class="center">
							<p>本当にログアウトしますか？</p>
						</div>
						<div id="dialogBtns">
							<button id="logoutYes" class="btn btn-success">確定</button>
							<button id="logoutNo" class="btn btn-warning">キャンセル</button>
						</div>
					</div>
				</div>
				<script>
					document.addEventListener('DOMContentLoaded', function () {
						let targetForm = null;

						document.querySelectorAll('.deleteBtn').forEach(btn => {
							btn.addEventListener('click', function () {
								targetForm = this.closest('form'); // 
								document.getElementById('overlay').style.display = 'flex';
							});
						});

				document.getElementById('btnNo').addEventListener('click', function () {
					document.getElementById('overlay').style.display = 'none';
					targetForm = null;
				});

				document.getElementById('btnOk').addEventListener('click', function () {
					if (targetForm) targetForm.submit();
				});
				const logoutLink = document.getElementById('logoutLink');
				const logoutOverlay = document.getElementById('logoutOverlay');
				const logoutYes = document.getElementById('logoutYes');
				const logoutNo = document.getElementById('logoutNo');

				if (logoutLink) {
					logoutLink.addEventListener('click', function (e) {
						e.preventDefault(); 
						logoutOverlay.style.display = 'flex';
					});
				}

				if (logoutNo) {
					logoutNo.addEventListener('click', function () {
						logoutOverlay.style.display = 'none';
					});
				}

				if (logoutYes) {
					logoutYes.addEventListener('click', function () {
						window.location.href = '/logout';
					});
				}
			});

			$(function () {
				$('#user').on('click', function (e) {
					e.stopPropagation();
					$('#dropdownMenu').toggle();
				});

				$(document).on('click', function () {
					$('#dropdownMenu').hide();
				});
			});


		</script>
		</body>

</html>