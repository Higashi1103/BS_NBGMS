<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<title>出力｜技術者管理システム</title>
	<meta charset="utf-8">
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js"></script>
	<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
	<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap.min.js"></script>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap.min.css" rel="stylesheet">

	<style>
		.navbar {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 51px;
			background-color: #f9f9f9;
			color: #000000;
			display: flex;
			align-items: center;
			padding: 0 10px;
			box-sizing: border-box;
			z-index: 1000;
			border-bottom: 1px solid #e5e5e5;
		}

		a {
			letter-spacing: 0.05em;
		}

		#title {
			position: absolute;
			left: 10px;
			top: 50%;
			transform: translateY(-50%);
			font-size: 18px;
			color: #777;
		}

		#user {
			position: absolute;
			right: 20px;
			top: 50%;
			transform: translateY(-50%);
			cursor: pointer;
		}

		.dropdown-menu {
			display: none;
			position: absolute;
			top: 40px;
			right: 0;
			transform: translateX(-90px);
			background-color: #fff;
			border: 1px solid #ddd;
			border-radius: 5px;
			box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
			min-width: 110px;
			z-index: 2000;
		}

		.dropdown-menu a {
			display: block;
			padding: 8px 10px;
			color: #333;
			text-decoration: none;
			font-size: 14px;
		}

		.dropdown-menu a:hover {
			background-color: #f2f2f2;
		}


		.sidebar {
			position: fixed;
			top: 51px;
			left: 0;
			width: 250px;
			height: calc(100% - 51px);
			background-color: #f9f9f9;
			color: rgb(48, 48, 48);
			box-sizing: border-box;
			border-right: 1px solid #e5e5e5;
		}

		.sidebar-nav div {
			margin: 0;
			padding: 10px;
			border-bottom: 1px solid #e5e5e5;

		}

		.sidebar-nav div a {
			color: #337ab7;
			font-size: 14px;
			text-decoration: none;
			display: flex;
			align-items: center;
		}

		.sidebar-nav div:hover {
			background-color: #e6e6e6;
			color: #fff;
		}

		.main-content {
			margin-top: 30px;
			margin-left: 310px;
			padding: 40px;
			min-height: calc(100vh - 51px);
			background-color: #fff;
			display: flex;
			flex-direction: column;
			align-items: center;
			width: 1100px;
		}

		#dataTables-example {
			width: 1000px;
			table-layout: auto;
		}

		.outputi {
			height: 100px;
			display: flex;
			justify-content: center;
			align-items: center;
			padding-left: 5px;
			padding-right: 5px;
		}

		#shutsuryokubtn {
			margin-bottom: 10px;
			text-align: right;
			background-color: rgb(155, 210, 135);

		}

		.field-table {
			margin: 0;
			height: 90px;
			width: 1000px;
			table-layout: fixed;

		}

		td {
			text-align: center;
			vertical-align: middle;
			border: 1px solid rgb(229, 229, 229);
		}

		.panel-heading {
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		.dialog {
			background: white;
			border-radius: 12px;
			width: 400px;
			height: auto;
			max-height: 90vh;
			overflow-y: auto;
			padding-bottom: 50px;
			box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
			z-index: 10000;
		}

		.dlgTitle {
			background-color: #f0ad4e;
			margin-top: 0;
			margin-bottom: 42px;
			border-radius: 12px 12px 0px 0px;
			padding: 10px;
			border-bottom: 1px solid gray;
			color: white
		}

		.center {
			text-align: center;
		}

		#dialogBtns {
			display: flex;
			justify-content: center;
			gap: 20px;
		}

		.overlay {
			position: fixed;
			top: 0;
			left: 0;
			width: 100vw;
			height: 100vh;
			background: rgba(0, 0, 0, 0.45);
			display: none;
			align-items: center;
			justify-content: center;
			z-index: 9999;

		}
	</style>
</head>

<body>
	<!-- ヘッド -->
	<nav class="navbar" style="margin-bottom: 0">
		<div id="title">技術者管理システム</div>

		<!-- ログアウトバタン -->
		<div id="user">
			<img src="/image/user.png" height="25px">
			<div class="dropdown-menu" id="dropdownMenu">
				<a href="/maipeji">マイページ</a>
				<a href="/yuzaichiran">ユーザー一覧</a>
				<a href="/logout" id="logoutLink">ログアウト</a>
			</div>
		</div>

		<!-- 左ナビ -->
		<div class="sidebar">
			<div class="sidebar-nav">
				<div>
					<a th:href="@{/kurasu}"><img src="/image/kurasu.png" height="18px"
							style="margin-right: 5px;">クラス情報</a>
				</div>
				<div>
					<a th:href="@{/gakusei}"><img src="/image/gakusei.png" height="18px"
							style="margin-right: 5px;">学生情報</a>
				</div>
				<div>
					<a th:href="@{/tensu}"><img src="/image/pointo.png" height="18px"
							style="margin-right: 5px;">ポイント履歴</a>
				</div>
				<div>
					<a th:href="@{/hiaringu}"><img src="/image/hiaringu.png" height="18px"
							style="margin-right: 5px;">ヒアリング履歴</a>
				</div>
				<div>
					<a th:href="@{/shuturyoku}"><img src="/image/shutsuryoku.png" height="18px"
							style="margin-right: 5px;">出力</a>
				</div>
			</div>
		</div>
	</nav>

	<div class="main-content">
		<div class="col-lg-12">

			<form th:action="@{/export}" method="post">
				<div class="filter-bar" style="display:flex;  margin-bottom: 20px;">
					<div><span>クラス選択：</span>
						<!--クラス名前選択-->
						<select id="kurasuSelect" name="kurasuNamae" class="form-control">
							<option th:each="k : ${kurasuList}" th:value="${k}" th:text="${k}"
								th:selected="${k == defaultKurasu} ? 'selected' : null"></option>
							<option value="" th:selected="${defaultKurasu == null}">すべてのクラス</option>
						</select>

					</div>
					<!--クラス年別入力-->
					<div><span style="padding-left:4px;">クラス年別：</span>
						<input type="text" id="kurasuInput" name="year" placeholder="（例: 2025）" class="form-control"
							pattern="20\d{2}" title="20で始まる4桁の数字を入力してください" style="margin-left: 5px;">
					</div>

				</div>
				<div class="panel panel-default">
					<div class="panel-heading d-flex justify-between">
						<strong>クラス情報</strong>
						<button type="button" class="btn btn-xs btn-primary select-toggle"
							data-target="#classPanel">すべて選択</button>
					</div>
					<div class="panel-body outputi" id="classPanel">
						<table class="field-table">
							<tr>
								<td><input type="hidden" name="fields" value="kurasuId">ID(固定)</td>
								<td><input type="hidden" name="fields" value="kurasuNamae">名前(固定)</td>
								<td><input type="hidden" name="fields" value="kurasuKamoku">科目(固定)</td>
								<td>
									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="tantoSensei">担当先生
										</label>
									</div>
								</td>
								<td>
									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="kurasuMemo">メモ
										</label>
									</div>
								</td>
							</tr>
						</table>
					</div>
				</div>

				<div class="panel panel-default">
					<div class="panel-heading d-flex justify-between">
						<strong>学生情報</strong>
						<button type="button" class="btn btn-xs btn-primary select-toggle"
							data-target="#gakuseiPanel">すべて選択</button>
					</div>
					<div class="panel-body outputi" id="gakuseiPanel">
						<table class="field-table">
							<tr>
								<td><input type="hidden" name="fields" value="gakuseiId">ID(固定)</td>
								<td><input type="hidden" name="fields" value="namae">名前(固定)</td>
								<td>
									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="seibetsu">性別
										</label>
									</div>
								</td>
								<td>
									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="seinengappi">生年月日
										</label>
									</div>
								</td>
								<td>

									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="saishuGakureki">最終学歴
										</label>
									</div>
								</td>

							</tr>
							<tr>
								<td>
									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="gogakuryoku">語学力
										</label>
									</div>
								</td>
								<td>
									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="tensu">点数
										</label>
									</div>
								</td>
								<td>
									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="hyouka">評価
										</label>
									</div>
								</td>
								<td>
									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="sonota">その他
										</label>
									</div>
								</td>
								<td></td>
							</tr>
						</table>
					</div>
				</div>

				<div class="panel panel-default">
					<div class="panel-heading d-flex justify-between">
						<strong>ポイント履歴</strong>
						<button type="button" class="btn btn-xs btn-primary select-toggle"
							data-target="#tensuPanel">すべて選択</button>
					</div>
					<div class="panel-body outputi" id="tensuPanel">
						<table class="field-table">
							<tr>
								<td><input type="hidden" name="fields" value="rirekiId">ID(固定)</td>
								<td><input type="hidden" name="fields" value="kagenTensu">加減点数(固定)</td>
								<td>
									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="kagenRiyu">加減理由
										</label>
									</div>
								</td>
								<td>
									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="hasseiBi">加減発生日
										</label>
									</div>
								</td>
								<td>
									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="tensuBiko">備考
										</label>
									</div>
								</td>

							</tr>

						</table>
					</div>
				</div>

				<div class="panel panel-default">
					<div class="panel-heading d-flex justify-between">
						<strong>ヒアリング履歴</strong>
						<button type="button" class="btn btn-xs btn-primary select-toggle"
							data-target="#hiaringuPanel">すべて選択</button>
					</div>
					<div class="panel-body outputi" id="hiaringuPanel">
						<table class="field-table">
							<tr>
								<td><input type="hidden" name="fields" value="hiaringuId">ID(固定)</td>
								<td><input type="hidden" name="fields" value="hiaringuTantousya">担当者(固定)</td>
								<td>
									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="hiaringuNichiji">発生日時
										</label>
									</div>
								</td>
								<td>
									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="hiaringuJikan">継続時間
										</label>
									</div>
								</td>

							</tr>
							<tr>
								<td>
									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="hiaringuBasyo">発生場所
										</label>
									</div>
								</td>
								<td>
									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="hiaringuGenin">ヒアリング原因
										</label>
									</div>
								</td>
								<td>
									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="hiaringuNaiyou">内容
										</label>
									</div>
								</td>
								<td>
									<div class="checkbox">
										<label>
											<input type="checkbox" name="fields" value="hiaringuBiko">備考
										</label>
									</div>
								</td>
							</tr>
						</table>
					</div>
				</div>

				<div class="text-right" style="margin-top: 25px;">
					<button type="submit" class="btn btn-success">出力</button>
				</div>
			</form>
		</div>
	</div>

	<div id="logoutOverlay" class="overlay">
		<div class="dialog">
			<p class="dlgTitle">確認</p>
			<div class="center">
				<p>本当にログアウトしますか？</p>
				<br>
			</div>
			<div id="dialogBtns">
				<button id="logoutYes" class="btn btn-success">確認</button>
				<button id="logoutNo" class="btn btn-warning">戻る</button>
			</div>
		</div>
	</div>
	<script>
		document.addEventListener('DOMContentLoaded', function () {

			const logoutLink = document.getElementById('logoutLink');
			const logoutOverlay = document.getElementById('logoutOverlay');
			const logoutYes = document.getElementById('logoutYes');
			const logoutNo = document.getElementById('logoutNo');

			if (logoutLink) {
				logoutLink.addEventListener('click', function (e) {
					e.preventDefault(); // 阻止直接跳转
					logoutOverlay.style.display = 'flex';
				});
			}

			if (logoutNo) {
				logoutNo.addEventListener('click', function () {
					logoutOverlay.style.display = 'none';
				});
			}

			if (logoutYes) {
				logoutYes.addEventListener('click', function () {
					window.location.href = '/logout';
				});
			}
		});


		$(function () {
			$('#user').on('click', function (e) {
				e.stopPropagation();
				$('#dropdownMenu').toggle();
			});

			$(document).on('click', function () {
				$('#dropdownMenu').hide();
			});
		});
		$(document).ready(function () {
			$('#dataTables-example').DataTable({
				responsive: true
			});
		});

		$(document).ready(function () {
			$(".select-toggle").click(function () {
				const target = $(this).data("target");
				const checkboxes = $(target).find("input[type='checkbox']");

				const allChecked = checkboxes.length > 0 && checkboxes.filter(":checked").length === checkboxes.length;

				if (allChecked) {
					// 全部取消
					checkboxes.prop("checked", false);
					$(this).text("すべて選択").removeClass("btn-danger").addClass("btn-primary");
				} else {
					// 全部选中
					checkboxes.prop("checked", true);
					$(this).text("すべて解除").removeClass("btn-primary").addClass("btn-danger");
				}
			});
		});
	</script>
</body>

</html>